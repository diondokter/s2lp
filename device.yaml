buffers:
  fifo:
    description: The TX and RX fifo. Writing writes to TX, reading reads from RX.
    id: 0xFF
    rw_type: rw

commands:
  TX:
    id: 0x60
    description: |
      Send the S2-LP to TX state for transmission.
      Valid from `READY` and `SYNTH_SETUP`.
  RX:
    id: 0x61
    description: |
      Send the S2-LP to RX state for reception.
      Valid from `READY` and `SYNTH_SETUP`.
  READY:
    id: 0x62
    description: |
      Go to READY state.
      Valid from `STANDBY`, `SLEEP` and `LOCK`.
  STANDBY:
    id: 0x63
    description: |
      Go to STANDBY state.
      Valid from `READY` and `SYNTH_SETUP`.
  SLEEP:
    id: 0x64
    description: |
      Go to SLEEP state.
      Valid from `READY`, `SYNTH_SETUP` and `WAIT_SLEEP`.
  LOCK_RX:
    id: 0x65
    description: |
      Go to LOCK state by using the RX configuration of the synthesizer.
      Valid from `READY` and `SYNTH_SETUP`.
  LOCK_TX:
    id: 0x66
    description: |
      Go to LOCK state by using the TX configuration of the synthesizer.
      Valid from `READY` and `SYNTH_SETUP`.
  ABORT:
    id: 0x67
    description: |
      Exit from TX or RX states and go to READY state.
      Valid from `TX` and `RX`.
  LDC_RELOAD:
    id: 0x68
    description: |
      Reload the LDC timer with a pre-programmed value stored in registers.
      Valid from `ANY`.
  RESET:
    id: 0x70
    description: |
      Reset the S2-LP state machine and registers values.
      Valid from `ANY`.
  FLUSH_RX_FIFO:
    id: 0x71
    description: |
      Clean the RX FIFO.
      Valid from `ALL`.
  FLUSH_TX_FIFO:
    id: 0x72
    description: |
      Clean the TX FIFO.
      Valid from `ALL`.
  SEQUENCE_UPDATE:
    id: 0x73
    description: |
      Reload the packet sequence counter with the value stored in register.
      Valid from `ANY`.

register_address_type: u8
registers:
  GPIO0_CONF:
    rw_type: rw
    address: 0x00
    size_bits: 8
    reset_value: 0x0A
    fields:
      GPIO_MODE:
        type: u8
        strict_conversion:
          HiZ: 0b00
          Input: 0b01
          OutputLowPower: 0b10
          OutputHighPower: default # 0b11
        start: 0
        end: 2
      GPIO_SELECT_OUTPUT:
        type: u8
        strict_conversion:
          Irq: 
            value: 0
            description: nIRQ (interrupt request, active low)
          POR: 
            value: 1
            description: POR inverted (active low)
          WakeUpTimerExpiration:
            value: 2
            description: Wake-up timer expiration. `1` when WUT has expired
          LowBatteryDetection:
            value: 3
            description: Low battery detection. `1` when battery is below threshold setting
          TxDataInternalClockOutput:
            value: 4
            description: TX data internal clock output (TX data are sampled on the rising edge of it)
          TxStateCommandInfo:
            value: 5
            description: TX state outputs a command information coming from the RADIO_TX block
          FifoAlmostEmpty:
            value: 6
            description: TX/RX FIFO almost empty flag
          FifoAlmostFull:
            value: 7
            description: TX/RX FIFO almost full flag
          RxDataOutput:
            value: 8
            description: RX data output
          RxClockOutput:
            value: 9
            description: RX clock output (recovered from received data)
          RxState:
            value: 10
            description: RX state indication. `1` when the S2-LP is transiting in the RX state
          DeviceNotSleepOrStandby:
            value: 11
            description: Device in a state other than SLEEP or STANDBY. `0` when in SLEEP/STANDBY
          DeviceStandby:
            value: 12
            description: Device in STANDBY state
          AntennaSwitch:
            value: 13
            description: Antenna switch signal used for antenna diversity
          ValidPreableDetected:
            value: 14
            description: Valid preamble detected flag
          SyncWordDetected:
            value: 15
            description: Sync word detected flag
          RssiThreshold:
            value: 16
            description: RSSI above threshold (same indication of CS register)
          Reserved:
            value: default
            description: Reserved value
          TxOrRxMode:
            value: 18
            description: TX or RX mode indicator (to enable an external range extender)
          VDD:
            value: 19
            description: VDD (to emulate an additional GPIO of the MCU, programmable by SPI)
          GND:
            value: 20
            description: GND (to emulate an additional GPIO of the MCU, programmable by SPI)
          ExternalSmps:
            value: 21
            description: External SMPS enable signal (active high)
          DeviceSleep:
            value: 22
            description: Device in SLEEP state
          DeviceReady:
            value: 23
            description: Device in READY state
          DeviceLock:
            value: 24
            description: Device in LOCK state
          WaitingForLockDetector:
            value: 25
            description: Device waiting for a high level of the lock-detector output signal
          TxDataOok:
            value: 26
            description: TX_DATA_OOK signal (internal control signal generated in the OOK analog smooth mode)
          WaitingForReady2:
            value: 27
            description: Device waiting for a high level of the READY2 signal from XO
          WaitingForPmBlockSettling:
            value: 28
            description: Device waiting for timer expiration to allow PM block settling
          WaitingForEndOfVcoCalibration:
            value: 29
            description: Device waiting for end of VCO calibration
          SynthBlockFullCircuitry:
            value: 30
            description: Device enables the full circuitry of the SYNTH block
        start: 3
        end: 8
      GPIO_SELECT_INPUT:
        type: u8
        strict_conversion:
          TxCommand: 
            value: 0
            description: 1 >> TX command
          RxCommand: 
            value: 1
            description: 1 >> RX command
          TxDataInput:
            value: 2
            description: TX data input for direct modulation
          Wakeup:
            value: 3
            description: Wake-up from external input (sensor output)
          ExternalClock:
            value: 4
            description: External clock @ 34.7 kHz (used for LDC modes timing)
          NotUsed:
            value: default
            description: Not used
        start: 3
        end: 8
  GPIO1_CONF:
    rw_type: rw
    address: 0x01
    size_bits: 8
    reset_value: 0xA2
    fields:
      GPIO_MODE:
        type: u8
        strict_conversion: GpioMode
        start: 0
        end: 2
      GPIO_SELECT_OUTPUT:
        type: u8
        strict_conversion: GpioSelectOutput
        start: 3
        end: 8
      GPIO_SELECT_INPUT:
        type: u8
        strict_conversion: GpioSelectInput
        start: 3
        end: 8
  GPIO2_CONF:
    rw_type: rw
    address: 0x02
    size_bits: 8
    reset_value: 0xA2
    fields:
      GPIO_MODE:
        type: u8
        strict_conversion: GpioMode
        start: 0
        end: 2
      GPIO_SELECT_OUTPUT:
        type: u8
        strict_conversion: GpioSelectOutput
        start: 3
        end: 8
      GPIO_SELECT_INPUT:
        type: u8
        strict_conversion: GpioSelectInput
        start: 3
        end: 8
  GPIO3_CONF:
    rw_type: rw
    address: 0x03
    size_bits: 8
    reset_value: 0xA2
    fields:
      GPIO_MODE:
        type: u8
        strict_conversion: GpioMode
        start: 0
        end: 2
      GPIO_SELECT_OUTPUT:
        type: u8
        strict_conversion: GpioSelectOutput
        start: 3
        end: 8
      GPIO_SELECT_INPUT:
        type: u8
        strict_conversion: GpioSelectInput
        start: 3
        end: 8
  SYNT3:
    rw_type: rw
    address: 0x05
    size_bits: 8
    reset_value: 0x42
    fields:
      PLL_CP_ISEL:
        type: u8
        start: 5
        end: 8
        description: Set the charge pump current according to the XTAL frequency (see Table 37. Table 34).
      BS:
        type: bool
        start: 4
        description: |
          Synthesizer band select. This parameter selects the out-of loop
          divide factor of the synthesizer:
          - false: 4, band select factor for high band
          - true: 8, band select factor for middle band
          (see Section 5.3.1 RF channel frequency settings).
      SYNT:
        type: u8
        start: 0
        end: 4
        description: MSB [27:24] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
  SYNT2:
    rw_type: rw
    address: 0x06
    size_bits: 8
    reset_value: 0x16
    description: The [23:16] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
    fields:
      SYNT:
        type: u8
        start: 0
        end: 8
        description: The [23:16] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
  SYNT1:
    rw_type: rw
    address: 0x07
    size_bits: 8
    reset_value: 0x27
    description: The [15:8] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
    fields:
      SYNT:
        type: u8
        start: 0
        end: 8
        description: The [15:8] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
  SYNT0:
    rw_type: rw
    address: 0x08
    size_bits: 8
    reset_value: 0x62
    description: LSB [7:0] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
    fields:
      SYNT:
        type: u8
        start: 0
        end: 8
        description: LSB [7:0] bits of the PLL programmable divider (see Section 5.3.1 RF channel frequency settings).
  IF_OFFSET_ANA:
    rw_type: rw
    address: 0x09
    size_bits: 8
    reset_value: 0x2A
    description: "Intermediate frequency setting for the analog RF synthesizer, default: 300 kHz, see Eq. (15)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  IF_OFFSET_DIG:
    rw_type: rw
    address: 0x0A
    size_bits: 8
    reset_value: 0xB8
    description: "Intermediate frequency setting for the digital shift-to-baseband circuits, default: 300 kHz, see Eq. (15)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  ChSpace:
    rw_type: rw
    address: 0x0C
    size_bits: 8
    reset_value: 0x3F
    description: "Channel spacing setting, see Eq. (16)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  ChNum:
    rw_type: rw
    address: 0x0D
    size_bits: 8
    reset_value: 0x00
    description: "Channel number. This value is multiplied by the channel spacing
      and added to the synthesizer base frequency to generate the
      actual RF carrier frequency, see Eq. (16)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  MOD4:
    rw_type: rw
    address: 0x0E
    size_bits: 8
    reset_value: 0x83
    description: "The MSB of the mantissa value of the data rate equation, see Eq. (14)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  MOD3:
    rw_type: rw
    address: 0x0F
    size_bits: 8
    reset_value: 0x2B
    description: "The LSB of the mantissa value of the data rate equation, see Eq. (14)."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  MOD2:
    rw_type: rw
    address: 0x10
    size_bits: 8
    reset_value: 0x77
    fields:
      ModulationType:
        type: u8
        start: 4
        end: 8
        strict_conversion:
          FSK2:
            value: 0
            description: 2-FSK
          FSK4:
            value: 1
            description: 4-FSK
          GFSK2BT1:
            value: 2
            description: 2-GFSK BT=1
          GFSK4BT1:
            value: 3
            description: 4-GFSK BT=1
          AskOok:
            value: 5
            description: ASK/OOK
          Unmodulated:
            value: 7
            description: Unmodulated
          GFSK2BT0_5:
            value: 10
            description: 2-GFSK BT=0.5
          GFSK4BT0_5:
            value: 11
            description: 4-GFSK BT=0.5
          illegal:
            value: catch-all
            description: Invalid value, do not use
      DATARATE_E:
        type: u8
        start: 0
        end: 4
        description: The exponent value of the data rate equation (see Eq. (14) ).
  MOD1:
    rw_type: rw
    address: 0x11
    size_bits: 8
    reset_value: 0x03
    fields:
      PA_INTERP_EN:
        type: bool
        start: 7
        description: Enable the PA power interpolator (see Section 5.6.1 PA configuration).
      MOD_INTERP_EN:
        type: bool
        start: 6
        description: Enable frequency interpolator for the GFSK shaping (see Section 5.4.1.1 Gaussian shaping).
      CONST_MAP:
        type: u8
        start: 4
        end: 6
        description: "Select the constellation map for 4-(G)FSK or 2-(G)FSK
          modulations (see Table 41. Constellation mapping 2-(G)FSK and
          Table 42. Constellation mapping 4-(G)FSK)."
      FDEV_E:
        type: u8
        start: 0
        end: 4
        description: "The exponent value of the frequency deviation equation (see Eq. (10))."
  MOD0:
    rw_type: rw
    address: 0x12
    size_bits: 8
    reset_value: 0x93
    description: "The mantissa value of the frequency deviation equation (see Eq. (10))."
    fields:
      value:
        type: u8
        start: 0
        end: 8
  ChFlt:
    rw_type: rw
    address: 0x13
    size_bits: 8
    reset_value: 0x23
    description: "Receiver channel filter"
    fields:
      ChFlt_M:
        type: u8
        start: 4
        end: 8
        description: The mantissa value of the receiver channel filter (see Table 44. Channel filter words).
      ChFlt_E:
        type: u8
        start: 0
        end: 4
        description: The exponent value of the receiver channel filter (see Table 44. Channel filter words).
  AFC2:
    rw_type: rw
    address: 0x14
    size_bits: 8
    reset_value: 0xC8
    description: Automatic frequency compensation register 2
    fields:
      AFC_FREEZE_ON_SYNC:
        type: bool
        start: 7
        description: Enable the freeze AFC correction upon sync word detection.
      AFC_ENABLED:
        type: bool
        start: 6
        description: Enable the AFC correction.
      AFC_MODE:
        type: u8
        start: 5
        end: 6
        strict_conversion:
          ClosedOnSlicer: 0
          ClosedOnSecondConversionStage: default
  AFC1:
    rw_type: rw
    address: 0x15
    size_bits: 8
    reset_value: 0x18
    description: Automatic frequency compensation register 1
    fields:
      AFC_FAST_PERIOD:
        type: u8
        start: 0
        end: 8
  AFC0:
    rw_type: rw
    address: 0x16
    size_bits: 8
    reset_value: 0x25
    description: Automatic frequency compensation register 0
    fields:
      AFC_FAST_GAIN:
        type: u8
        start: 4
        end: 8
        description: The AFC loop gain in fast mode (2's log).
      AFC_SLOW_GAIN:
        type: u8
        start: 0
        end: 4
        description: The AFC loop gain in slow mode (2's log).
  RSSI_FLT:
    rw_type: rw
    address: 0x17
    size_bits: 8
    reset_value: 0xE3
    description: RSSI filter
    fields:
      RSSI_FLT:
        type: u8
        start: 4
        end: 8
        description: Gain of the RSSI filter.
      CS_MODE:
        type: u8
        start: 2
        end: 4
        description: Carrier sense mode (see Section 5.5.8.2 Carrier sense)
        strict_conversion:
          StaticCS:
            value: 0b00
            description: Static CS
          DynamicCS6db:
            value: 0b01
            description: Dynamic CS with 6dB dynamic threshold
          DynamicCS12db:
            value: 0b10
            description: Dynamic CS with 12dB dynamic threshold
          DynamicCS18db:
            value: default # 0b11
            description: Dynamic CS with 18dB dynamic threshold
